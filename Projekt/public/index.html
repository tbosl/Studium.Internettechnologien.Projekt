<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="media/SEC Logo kompakt.png">
    <link rel="stylesheet" href="css/header.css" type="text/css">
    <link rel="stylesheet" href="css/content.css" type="text/css">
    <link rel="stylesheet" href="css/chat.css" type="text/css">
    <script src="/js/jquery.js"></script>
</head>

<body>
    <div id="background">
        <header>
            <nav>
                <ul>
                    <li>
                        <a href="info.html">
                            <img id="logo" src="media/SEC_Logo_kompakt_weiÃŸ.png" width="80vh" alt="Logo">
                        </a>
                    </li>
                    <li>
                        <a class="links-to-other-pages" id="links-to-chat" href="index.html">Chat</a>
                    </li>
                    <li>
                        <a class="links-to-other-pages" href="events.html">Events</a>
                    </li>
                    <li>
                        <a class="links-to-other-pages" href="contacts.html">Kontakt</a>
                    </li>
                </ul>
            </nav>
        </header>
        <div id="msgs" style="height:400px; width:400px; overflow: scroll; float:left;">
        </div>
        <div id="users" style="height:400px; width:100px; overflow: scroll;">
        </div>
        <form id="chatForm">
            <label for="msg">u1:&nbsp;</label>
            <input id="msg" type="text" />
            <button id="sendBtn">Send</button>
            <script>
                const answers = new Array(40);
                var i = 0;
                var socket = new WebSocket('ws://127.0.0.1:8181/', 'chat');
                var name = 'u1'
                socket.onopen = function () {

                    name = "name" + Math.floor(Math.random() * Math.floor(700));

                    socket.send('{"type": "join", "name":"' + name + '"}');
                }
                $('#sendBtn').on('click', function (e) {
                    e.preventDefault();
                    //name = 'u1',
                    msg = $('#msg').val();
                    socket.send('{"type": "msg", "msg": "' + msg + '","sender":"' + name + '"}');
                    $('#msg').val('');
                });
                socket.onmessage = function (msg) {
                    var data = JSON.parse(msg.data);
                    switch (data.type) {
                        case 'msg':
                            if (data.name == name || (data.name == "MegaBot" && data.sender == name) || (data.name == "MegaBot" && data.sender == "MegaBot"))
                                var msg = $('<div>' + data.name + ': ' + data.msg +
                                    '</div>');
                            $('#msgs').append(msg);
                            answers[i] = data.msg;
                            //document.write(answers[i]);
                            i++;
                            break;
                        case 'join':
                            $('#users').empty();
                            for (var i = 0; i < data.names.length; i++) {
                                var user = $('<div>' + data.names[i] + '</div>');
                                $('#users').append(user);
                            }
                            break;
                    }
                };

            </script>
        </form>
    </div>
</body>

</html>